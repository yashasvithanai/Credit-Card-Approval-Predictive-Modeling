---
title: "Homework 3"
author: "ythanai"
output: html_document
---

Please read all instructions carefully.  Try to knit the file before final submission to catch any bugs.  To allow this file to be knit, you might need to save it in a new location, as you do not have write permissions in the dropbox folder, and R does not work well with Chinese characters.  
Some important steps: 
	1. Rename this file to your blackboard username.  This lets us grade your assignment.
	2. This assignment requires you to submit an RData file generated by this script.  See the assignment sheet and video for details on how to do this. Submissions that do not include the correct files will be penalized.
	3. Please do not create new columns in the data frame - you can include things like polynomials directly in the model formula.


**Question 1A:**
```{r Question 1A}
#TRAIN AND ESTIMATE YOUR FIRST MODEL (WITHOUT REPORTS) HERE, starting on line 17
setwd("/Users/yashasvithanai/Desktop/Simon/Predictive & Causal Analytics/HW 3")
fullFile = read.csv('Student Data 5.csv')
str(fullFile)
summary(fullFile)

#training the data
getDataFoldRMSE = function(testFit){
  set.seed(1)
  totalFold= 5
  foldNum= floor(runif(nrow(fullFile))*totalFold)+1
  thisModelRMSE = rep(NA, totalFold)
  for(thisFold in 1:totalFold){
    trainingData = subset(fullFile, foldNum !=thisFold)
    validationData = subset(fullFile, foldNum ==thisFold)
    thisModel = update(testFit, data = trainingData)
    thisFit = mean((predict(thisModel, validationData) - validationData$card)^2)^0.5
    thisModelRMSE[thisFold]=thisFit
  }
  return(mean(thisModelRMSE))
}

library(earth)

# RSME
getDataFoldRMSE(earth(card~share+expenditure+active+age*share+age*owner+income*share+share*expenditure, data=fullFile))

getDataFoldRMSE(lm(card~share+expenditure+active+age*share+age*owner+income*share+share*expenditure, data=fullFile))

getDataFoldRMSE(earth(card~age+income+share+owner+majorcards+active+poly(expenditure,2), data=fullFile))

getDataFoldRMSE(earth(card~age+income+share+owner+majorcards+active, data=fullFile))

getDataFoldRMSE(earth(card~age+income+share+owner+majorcards+active+poly(months,2)+poly(expenditure,2), data=fullFile, degree=2))

getDataFoldRMSE(earth(card~income+share+majorcards+poly(active,2)+poly(months,2)+expenditure+age*owner, data=fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~age+income+share+owner+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile, degree=2))

# lowest so far
getDataFoldRMSE(earth(card~income+share+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile, degree=2))

getDataFoldRMSE(lm(card~income+share+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile))

getDataFoldRMSE(lm(card~age+income+share+owner+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile))

model1A = earth(card~income+share+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile, degree=2)
model1A

```



**Question 1B:**
```{r Question 1B}
#TRAIN AND ESTIMATE YOUR SECOND MODEL (WITH REPORTS) HERE, starting on line 30
getDataFoldRMSE(lm(card~reports+age+income+share+owner+majorcards+active , data=fullFile))

getDataFoldRMSE(earth(card~reports+age+income+share+owner+majorcards+active , data=fullFile))

getDataFoldRMSE(earth(card~reports+age+income+share+owner+majorcards+active+poly(expenditure,4) , data=fullFile, degree=2))

getDataFoldRMSE(earth(card~reports+age+income+share+owner+majorcards+active+poly(months,2)+poly(expenditure,2), data=fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~reports+share+poly(expenditure,2)+active+age*owner+income*share+share*expenditure, data = fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~reports+income+share+owner+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~reports+share+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner+income*share, data=fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~reports+income+share+majorcards+active+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~reports+income+share+majorcards+poly(active,2)+poly(months,2)+poly(expenditure,2)+age*owner, data=fullFile, degree=2, thres=.0001))

getDataFoldRMSE(earth(card~reports+income+share+majorcards+poly(active,2)+poly(months,2)+expenditure+age*owner, data=fullFile, degree=2, thres=.0001))
# lowest so far

getDataFoldRMSE(lm(card~reports+income+share+majorcards+poly(active,2)+poly(months,2)+expenditure+age*owner, data=fullFile))

#Last line should store a model in model1B as below
model1B = earth(card~reports+income+share+majorcards+poly(active,2)+poly(months,2)+expenditure+age*owner, data=fullFile, degree=2, thres=.0001)
model1B

```


```{r, quietly=FALSE,warning=FALSE,echo=FALSE,results=TRUE}
#The following code checks if you generated the models correctly.  Run it, and if you don't see any of the error messages below. Do not alter it any way - not even to change the variable names.  If not, please correct, or contact the TAs for help 


#This reduces the file size in some cases fringe cases
model1A$cv.list = NULL
model1A$cv.oof.fit.tab = NULL
model1A$varmod = NULL

model1B$cv.list = NULL
model1B$cv.oof.fit.tab = NULL
model1B$varmod = NULL

isError = FALSE

if(!(class(model1A)=='earth'|class(model1A)=='lm')){
	print('model1A is not an earth or lm model.  Be sure to submit a statistical model here.')
  isError = TRUE}
	
if(!(class(model1B)=='earth'|class(model1B)=='lm')){
	print('model1B is not an earth or lm model.  Be sure to submit a statistical model here.')
  isError = TRUE}


if(class(model1A)=='earth'){
	noReport = !(grepl('reports',paste(rownames(model1A$coefficients),collapse=' ')))
}  else {
	noReport = !(grepl('reports',paste(names(model1A$coefficients),collapse=' ')))
}

if(!noReport){
	print('Make sure you do not use the report variable in model1A')
  isError = TRUE
}

if(!isError){
  save(model1A, model1B, file = 'MyModels.Rdata')
  print('MyModels.Rdata generated!  Please submit this file via blackboard.')
} else {
  print('Your code does not produce the right output.  Please correct your code, or get in touch with the TA.')
}

```
